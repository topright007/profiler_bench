<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="03-seed-large-customers" author="profiler">
        <sql>
            -- Insert 10 large customers
            INSERT INTO customers (name, email, phone, customer_type, created_at)
            SELECT 
                'Large Enterprise ' || i,
                'large' || i || '@enterprise.com',
                '+1-800-' || LPAD(i::text, 7, '0'),
                'LARGE',
                NOW() - (random() * INTERVAL '365 days')
            FROM generate_series(1, 10) AS i;
            
            -- For each large customer, create 50-200 buildings
            INSERT INTO buildings (name, address, building_type, square_meters, customer_id)
            SELECT 
                'Building ' || (ROW_NUMBER() OVER (PARTITION BY c.id)) || ' of ' || c.name,
                'Office Park ' || ((ROW_NUMBER() OVER (PARTITION BY c.id)) / 10 + 1) || ', Suite ' || (ROW_NUMBER() OVER (PARTITION BY c.id)),
                CASE (random() * 2)::int
                    WHEN 0 THEN 'RESIDENTIAL'
                    WHEN 1 THEN 'COMMERCIAL'
                    ELSE 'INDUSTRIAL'
                END,
                (100 + (random() * 900))::int,
                c.id
            FROM customers c
            CROSS JOIN generate_series(1, (50 + (random() * 150)::int)) AS building_num
            WHERE c.customer_type = 'LARGE';
            
            -- For each large customer building, create 20-100 devices
            INSERT INTO devices (name, device_type, manufacturer, model_number, power_consumption, installation_date, status, building_id)
            SELECT 
                'Device ' || LPAD((ROW_NUMBER() OVER (PARTITION BY b.id))::text, 4, '0'),
                CASE (random() * 5)::int
                    WHEN 0 THEN 'SENSOR'
                    WHEN 1 THEN 'ACTUATOR'
                    WHEN 2 THEN 'CONTROLLER'
                    WHEN 3 THEN 'CAMERA'
                    WHEN 4 THEN 'THERMOSTAT'
                    ELSE 'SMART_LOCK'
                END,
                CASE (random() * 3)::int
                    WHEN 0 THEN 'TechCorp'
                    WHEN 1 THEN 'SmartDevices Inc'
                    WHEN 2 THEN 'IoT Solutions'
                    ELSE 'AutomationPro'
                END,
                'MODEL-' || LPAD(((random() * 9999)::int)::text, 4, '0'),
                (5 + (random() * 95))::int,
                NOW() - (random() * INTERVAL '730 days'),
                CASE (random() * 10)::int
                    WHEN 0 THEN 'MAINTENANCE'
                    WHEN 1 THEN 'INACTIVE'
                    ELSE 'ACTIVE'
                END,
                b.id
            FROM buildings b
            CROSS JOIN generate_series(1, (20 + (random() * 80)::int)) AS device_num
            WHERE b.customer_id IN (SELECT id FROM customers WHERE customer_type = 'LARGE');
        </sql>
    </changeSet>

</databaseChangeLog>
